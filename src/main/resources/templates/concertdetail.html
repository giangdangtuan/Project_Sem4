<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Chi Tiết Concert</title>
    <style>
        .seat-row {
            display: flex; /* Sắp xếp các ghế theo hàng ngang */
            margin-bottom: 5px;
        }
        .seat {
            display: inline-flex;
            width: 30px;
            height: 30px;
            margin: 5px;
            text-align: center;
            line-height: 30px;
            border: 1px solid #000;
            cursor: pointer;
        }
        .occupied {
            background-color: red;
            color: white;
            cursor: not-allowed; /* Không cho phép nhấp vào ghế đã chiếm chỗ */
        }
        .available {
            background-color: green;
            color: white;
        }
        .selected {
            background-color: yellow; /* Màu ghế đã chọn */
            color: black; /* Màu chữ khi đã chọn */
        }
    </style>
    <script>
        let selectedSeats = [];

        function selectSeat(seatId, seatStatus) {
            const seatElement = document.getElementById("seat-" + seatId);

            if (selectedSeats.includes(seatId)) {
                // Nếu ghế đã được chọn, bỏ chọn
                selectedSeats = selectedSeats.filter(id => id !== seatId);
                seatElement.classList.remove("selected");
            } else {
                // Nếu ghế chưa được chọn, chọn nó
                selectedSeats.push(seatId);
                seatElement.classList.add("selected");
            }

            console.log("Selected seats: ", selectedSeats); // Xem danh sách ghế đã chọn
        }

        function updateSeats() {
            fetch('/concert/updateSeats', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(selectedSeats),
            })
            .then(response => {
                if (response.redirected) {
                    window.location.href = response.url; // Redirect tới trang mới
                }
            })
            .catch(error => console.error('Error:', error));
        }
    </script>
</head>
<body>
    <h1>Chi Tiết Concert</h1>

    <h2 th:text="${concert.name}"></h2>
    <p>Thời gian: <span th:text="${concert.duration}"></span> phút</p>
    <p>Bắt đầu bán: <span th:text="${concert.startSale}"></span></p>
    <p>Kết thúc bán: <span th:text="${concert.endSale}"></span></p>
    <p>Bắt đầu diễn ra: <span th:text="${concert.startDate}"></span></p>
    <p>Link Video: <a th:href="${concert.videoLink}" th:text="${concert.videoLink}"></a></p>

    <h2>Ghế</h2>
    <div id="seats">
        <div th:each="row : ${#numbers.sequence(1, 40)}" class="seat-row">
            <div th:each="seat : ${seats}" th:if="${seat.seat_row == row}">
                <div th:id="'seat-' + ${seat.id}"
                     class="seat"
                     th:text="${seat.row} + '-' + ${seat.seat_column}"
                     th:class="${seat.status ? 'occupied' : 'available'}"
                     th:onclick="'selectSeat(' + ${seat.id} + ', ' + ${seat.status} + ')'">
                </div>
            </div>
        </div>
    </div>
    <button onclick="updateSeats()">Cập nhật ghế</button>
</body>
</html>
